apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: homelab-root
  namespace: argocd
spec:
  project: default

  source:
    repoURL: https://github.com/zexianchoo/homelab-argo.git
    targetRevision: HEAD
    path: apps 
    directory:
      recurse: true
  destination:
    server: 'https://kubernetes.default.svc'
    namespace: argocd

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true  
---
apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: azure-keyvault 
  namespace: external-secrets
spec:
  provider:
    azurekv:
      vaultUrl: https://homelab-key-vault.vault.azure.net/
      tenantId: af8036c0-68ca-4751-bb29-7d6db996bdd1
      authSecretRef:
        clientId:
          name: azure-key-vault-credentials
          key: client_id         
        clientSecret:
          name: azure-key-vault-credentials
          key: client_secret       